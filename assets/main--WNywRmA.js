import{l as Ee}from"./lz-string-DwU0FdxF.js";const K=(e,n)=>n.some(t=>e instanceof t);let ne,re;function xe(){return ne||(ne=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Te(){return re||(re=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const z=new WeakMap,G=new WeakMap,N=new WeakMap;function Ie(e){const n=new Promise((t,u)=>{const p=()=>{e.removeEventListener("success",y),e.removeEventListener("error",v)},y=()=>{t(O(e.result)),p()},v=()=>{u(e.error),p()};e.addEventListener("success",y),e.addEventListener("error",v)});return N.set(n,e),n}function Ae(e){if(z.has(e))return;const n=new Promise((t,u)=>{const p=()=>{e.removeEventListener("complete",y),e.removeEventListener("error",v),e.removeEventListener("abort",v)},y=()=>{t(),p()},v=()=>{u(e.error||new DOMException("AbortError","AbortError")),p()};e.addEventListener("complete",y),e.addEventListener("error",v),e.addEventListener("abort",v)});z.set(e,n)}let Q={get(e,n,t){if(e instanceof IDBTransaction){if(n==="done")return z.get(e);if(n==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return O(e[n])},set(e,n,t){return e[n]=t,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function se(e){Q=e(Q)}function Se(e){return Te().includes(e)?function(...n){return e.apply(Y(this),n),O(this.request)}:function(...n){return O(e.apply(Y(this),n))}}function Ce(e){return typeof e=="function"?Se(e):(e instanceof IDBTransaction&&Ae(e),K(e,xe())?new Proxy(e,Q):e)}function O(e){if(e instanceof IDBRequest)return Ie(e);if(G.has(e))return G.get(e);const n=Ce(e);return n!==e&&(G.set(e,n),N.set(n,e)),n}const Y=e=>N.get(e);function Be(e,n,{blocked:t,upgrade:u,blocking:p,terminated:y}={}){const v=indexedDB.open(e,n),E=O(v);return u&&v.addEventListener("upgradeneeded",b=>{u(O(v.result),b.oldVersion,b.newVersion,O(v.transaction),b)}),t&&v.addEventListener("blocked",b=>t(b.oldVersion,b.newVersion,b)),E.then(b=>{y&&b.addEventListener("close",()=>y()),p&&b.addEventListener("versionchange",L=>p(L.oldVersion,L.newVersion,L))}).catch(()=>{}),E}const De=["get","getKey","getAll","getAllKeys","count"],Le=["put","add","delete","clear"],_=new Map;function oe(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(_.get(n))return _.get(n);const t=n.replace(/FromIndex$/,""),u=n!==t,p=Le.includes(t);if(!(t in(u?IDBIndex:IDBObjectStore).prototype)||!(p||De.includes(t)))return;const y=async function(v,...E){const b=this.transaction(v,p?"readwrite":"readonly");let L=b.store;return u&&(L=L.index(E.shift())),(await Promise.all([L[t](...E),p&&b.done]))[0]};return _.set(n,y),y}se(e=>({...e,get:(n,t,u)=>oe(n,t)||e.get(n,t,u),has:(n,t)=>!!oe(n,t)||e.has(n,t)}));const Me=["continue","continuePrimaryKey","advance"],ie={},Z=new WeakMap,ue=new WeakMap,Ue={get(e,n){if(!Me.includes(n))return e[n];let t=ie[n];return t||(t=ie[n]=function(...u){Z.set(this,ue.get(this)[n](...u))}),t}};async function*Re(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const t=new Proxy(n,Ue);for(ue.set(t,n),N.set(t,Y(n));n;)yield t,n=await(Z.get(t)||n.continue()),Z.delete(t)}function ae(e,n){return n===Symbol.asyncIterator&&K(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&K(e,[IDBIndex,IDBObjectStore])}se(e=>({...e,get(n,t,u){return ae(n,t)?Re:e.get(n,t,u)},has(n,t){return ae(n,t)||e.has(n,t)}}));function ke(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var J={exports:{}},ce;function je(){return ce||(ce=1,function(e){(function(n){var t=ve(),u=we(),p=be(),y=Pe(),v={imagePlaceholder:void 0,cacheBust:!1},E={toSvg:b,toPng:fe,toJpeg:de,toBlob:he,toPixelData:L,impl:{fontFaces:p,images:y,util:t,inliner:u,options:{}}};e.exports=E;function b(i,o){return o=o||{},me(o),Promise.resolve(i).then(function(s){return te(s,o.filter,!0)}).then(ge).then(pe).then(a).then(function(s){return ye(s,o.width||t.width(i),o.height||t.height(i))});function a(s){return o.bgcolor&&(s.style.backgroundColor=o.bgcolor),o.width&&(s.style.width=o.width+"px"),o.height&&(s.style.height=o.height+"px"),o.style&&Object.keys(o.style).forEach(function(h){s.style[h]=o.style[h]}),s}}function L(i,o){return F(i,o||{}).then(function(a){return a.getContext("2d").getImageData(0,0,t.width(i),t.height(i)).data})}function fe(i,o){return F(i,o||{}).then(function(a){return a.toDataURL()})}function de(i,o){return o=o||{},F(i,o).then(function(a){return a.toDataURL("image/jpeg",o.quality||1)})}function he(i,o){return F(i,o||{}).then(t.canvasToBlob)}function me(i){typeof i.imagePlaceholder>"u"?E.impl.options.imagePlaceholder=v.imagePlaceholder:E.impl.options.imagePlaceholder=i.imagePlaceholder,typeof i.cacheBust>"u"?E.impl.options.cacheBust=v.cacheBust:E.impl.options.cacheBust=i.cacheBust}function F(i,o){return b(i,o).then(t.makeImage).then(t.delay(100)).then(function(s){var h=a(i);return h.getContext("2d").drawImage(s,0,0),h});function a(s){var h=document.createElement("canvas");if(h.width=o.width||t.width(s),h.height=o.height||t.height(s),o.bgcolor){var d=h.getContext("2d");d.fillStyle=o.bgcolor,d.fillRect(0,0,h.width,h.height)}return h}}function te(i,o,a){if(!a&&o&&!o(i))return Promise.resolve();return Promise.resolve(i).then(s).then(function(c){return h(i,c,o)}).then(function(c){return d(i,c)});function s(c){return c instanceof HTMLCanvasElement?t.makeImage(c.toDataURL()):c.cloneNode(!1)}function h(c,l,T){var B=c.childNodes;if(B.length===0)return Promise.resolve(l);return w(l,t.asArray(B),T).then(function(){return l});function w(j,A,P){var S=Promise.resolve();return A.forEach(function(k){S=S.then(function(){return te(k,P)}).then(function(C){C&&j.appendChild(C)})}),S}}function d(c,l){if(!(l instanceof Element))return l;return Promise.resolve().then(T).then(B).then(w).then(j).then(function(){return l});function T(){A(window.getComputedStyle(c),l.style);function A(P,S){P.cssText?S.cssText=P.cssText:k(P,S);function k(C,M){t.asArray(C).forEach(function(r){M.setProperty(r,C.getPropertyValue(r),C.getPropertyPriority(r))})}}}function B(){[":before",":after"].forEach(function(P){A(P)});function A(P){var S=window.getComputedStyle(c,P),k=S.getPropertyValue("content");if(k===""||k==="none")return;var C=t.uid();l.className=l.className+" "+C;var M=document.createElement("style");M.appendChild(r(C,P,S)),l.appendChild(M);function r(f,g,m){var x="."+f+":"+g,D=m.cssText?H(m):X(m);return document.createTextNode(x+"{"+D+"}");function H(U){var R=U.getPropertyValue("content");return U.cssText+" content: "+R+";"}function X(U){return t.asArray(U).map(R).join("; ")+";";function R(V){return V+": "+U.getPropertyValue(V)+(U.getPropertyPriority(V)?" !important":"")}}}}}function w(){c instanceof HTMLTextAreaElement&&(l.innerHTML=c.value),c instanceof HTMLInputElement&&l.setAttribute("value",c.value)}function j(){l instanceof SVGElement&&(l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l instanceof SVGRectElement&&["width","height"].forEach(function(A){var P=l.getAttribute(A);P&&l.style.setProperty(A,P)}))}}}function ge(i){return p.resolveAll().then(function(o){var a=document.createElement("style");return i.appendChild(a),a.appendChild(document.createTextNode(o)),i})}function pe(i){return y.inlineAll(i).then(function(){return i})}function ye(i,o,a){return Promise.resolve(i).then(function(s){return s.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(s)}).then(t.escapeXhtml).then(function(s){return'<foreignObject x="0" y="0" width="100%" height="100%">'+s+"</foreignObject>"}).then(function(s){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+o+'" height="'+a+'">'+s+"</svg>"}).then(function(s){return"data:image/svg+xml;charset=utf-8,"+s})}function ve(){return{escape:j,parseExtension:o,mimeType:a,dataAsUrl:w,isDataUrl:s,canvasToBlob:d,resolveUrl:c,getAndEncode:B,uid:l(),delay:A,asArray:P,escapeXhtml:S,makeImage:T,width:k,height:C};function i(){var r="application/font-woff",f="image/jpeg";return{woff:r,woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:f,jpeg:f,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function o(r){var f=/\.([^\.\/]*?)$/g.exec(r);return f?f[1]:""}function a(r){var f=o(r).toLowerCase();return i()[f]||""}function s(r){return r.search(/^(data:)/)!==-1}function h(r){return new Promise(function(f){for(var g=window.atob(r.toDataURL().split(",")[1]),m=g.length,x=new Uint8Array(m),D=0;D<m;D++)x[D]=g.charCodeAt(D);f(new Blob([x],{type:"image/png"}))})}function d(r){return r.toBlob?new Promise(function(f){r.toBlob(f)}):h(r)}function c(r,f){var g=document.implementation.createHTMLDocument(),m=g.createElement("base");g.head.appendChild(m);var x=g.createElement("a");return g.body.appendChild(x),m.href=f,x.href=r,x.href}function l(){var r=0;return function(){return"u"+f()+r++;function f(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function T(r){return new Promise(function(f,g){var m=new Image;m.onload=function(){f(m)},m.onerror=g,m.src=r})}function B(r){var f=3e4;return E.impl.options.cacheBust&&(r+=(/\?/.test(r)?"&":"?")+new Date().getTime()),new Promise(function(g){var m=new XMLHttpRequest;m.onreadystatechange=H,m.ontimeout=X,m.responseType="blob",m.timeout=f,m.open("GET",r,!0),m.send();var x;if(E.impl.options.imagePlaceholder){var D=E.impl.options.imagePlaceholder.split(/,/);D&&D[1]&&(x=D[1])}function H(){if(m.readyState===4){if(m.status!==200){x?g(x):U("cannot fetch resource: "+r+", status: "+m.status);return}var R=new FileReader;R.onloadend=function(){var V=R.result.split(/,/)[1];g(V)},R.readAsDataURL(m.response)}}function X(){x?g(x):U("timeout of "+f+"ms occured while fetching resource: "+r)}function U(R){console.error(R),g("")}})}function w(r,f){return"data:"+f+";base64,"+r}function j(r){return r.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function A(r){return function(f){return new Promise(function(g){setTimeout(function(){g(f)},r)})}}function P(r){for(var f=[],g=r.length,m=0;m<g;m++)f.push(r[m]);return f}function S(r){return r.replace(/#/g,"%23").replace(/\n/g,"%0A")}function k(r){var f=M(r,"border-left-width"),g=M(r,"border-right-width");return r.scrollWidth+f+g}function C(r){var f=M(r,"border-top-width"),g=M(r,"border-bottom-width");return r.scrollHeight+f+g}function M(r,f){var g=window.getComputedStyle(r).getPropertyValue(f);return parseFloat(g.replace("px",""))}}function we(){var i=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:h,shouldProcess:o,impl:{readUrls:a,inline:s}};function o(d){return d.search(i)!==-1}function a(d){for(var c=[],l;(l=i.exec(d))!==null;)c.push(l[1]);return c.filter(function(T){return!t.isDataUrl(T)})}function s(d,c,l,T){return Promise.resolve(c).then(function(w){return l?t.resolveUrl(w,l):w}).then(T||t.getAndEncode).then(function(w){return t.dataAsUrl(w,t.mimeType(c))}).then(function(w){return d.replace(B(c),"$1"+w+"$3")});function B(w){return new RegExp(`(url\\(['"]?)(`+t.escape(w)+`)(['"]?\\))`,"g")}}function h(d,c,l){if(T())return Promise.resolve(d);return Promise.resolve(d).then(a).then(function(B){var w=Promise.resolve(d);return B.forEach(function(j){w=w.then(function(A){return s(A,j,c,l)})}),w});function T(){return!o(d)}}}function be(){return{resolveAll:i,impl:{readAll:o}};function i(){return o().then(function(a){return Promise.all(a.map(function(s){return s.resolve()}))}).then(function(a){return a.join(`
`)})}function o(){return Promise.resolve(t.asArray(document.styleSheets)).then(s).then(a).then(function(d){return d.map(h)});function a(d){return d.filter(function(c){return c.type===CSSRule.FONT_FACE_RULE}).filter(function(c){return u.shouldProcess(c.style.getPropertyValue("src"))})}function s(d){var c=[];return d.forEach(function(l){try{t.asArray(l.cssRules||[]).forEach(c.push.bind(c))}catch(T){console.log("Error while reading CSS rules from "+l.href,T.toString())}}),c}function h(d){return{resolve:function(){var l=(d.parentStyleSheet||{}).href;return u.inlineAll(d.cssText,l)},src:function(){return d.style.getPropertyValue("src")}}}}}function Pe(){return{inlineAll:o,impl:{newImage:i}};function i(a){return{inline:s};function s(h){return t.isDataUrl(a.src)?Promise.resolve():Promise.resolve(a.src).then(h||t.getAndEncode).then(function(d){return t.dataAsUrl(d,t.mimeType(a.src))}).then(function(d){return new Promise(function(c,l){a.onload=c,a.onerror=l,a.src=d})})}}function o(a){if(!(a instanceof Element))return Promise.resolve(a);return s(a).then(function(){return a instanceof HTMLImageElement?i(a).inline():Promise.all(t.asArray(a.childNodes).map(function(h){return o(h)}))});function s(h){var d=h.style.getPropertyValue("background");return d?u.inlineAll(d).then(function(c){h.style.setProperty("background",c,h.style.getPropertyPriority("background"))}).then(function(){return h}):Promise.resolve(h)}}}})()}(J)),J.exports}var Oe=je();const qe=ke(Oe),Ve=document.querySelector("table"),Fe=document.querySelector(".save"),Ne=document.querySelector(".new"),We=document.querySelector("#share");for(let e=0;e<5;e++){const n=Ve.insertRow();for(let t=0;t<5;t++){const u=n.insertCell();u.contentEditable=!0}}function $e(e,n){let t;return(...u)=>{clearTimeout(t),t=setTimeout(()=>e(...u),n)}}const q=Be("bingo-db",1,{upgrade(e){e.createObjectStore("cards",{keyPath:"id",autoIncrement:!0})}});$();let I=null;async function W(){const e=await q,n=document.querySelector(".title span:nth-child(2)").innerText.trim(),t=Array.from(document.querySelectorAll("table td")).map(y=>y.innerText.trim()),u={title:n,cells:t};I&&(u.id=I),I=await e.put("cards",u),$()}const le=$e(W,500);document.querySelector(".title").addEventListener("input",le);document.querySelector("table").addEventListener("input",le);document.getElementById("cardList").addEventListener("change",async e=>{const n=Number(e.target.value);ee(n),I=n});function He(){document.querySelector(".title span:nth-child(2)").innerText="Новое бинго",document.querySelectorAll("table td").forEach(e=>e.innerText=""),I=null,W()}async function ee(e){const t=await(await q).get("cards",e);if(!t)return;document.querySelector(".title span:nth-child(2)").innerText=t.title;const u=document.querySelectorAll("table td");t.cells.forEach((p,y)=>{u[y]&&(u[y].innerText=p)})}async function $(){const n=await(await q).getAll("cards"),t=document.getElementById("cardList");t.innerHTML="";for(const u of n){const p=document.createElement("option");p.value=u.id;const y=(u.title||`Бинго #${u.id}`).trim(),v=y.length>26?y.substring(0,26)+"…":y;p.textContent=v,u.id===I&&(p.selected=!0),t.appendChild(p)}}document.getElementById("deleteBtn").addEventListener("click",async()=>{if(!I){alert("Нет выбранной карточки для удаления");return}const e=await q;await e.delete("cards",I),alert("Карточка удалена"),I=null;const n=await e.getAll("cards");if(n.length>0){const t=n[0];ee(t.id),I=t.id}else document.querySelector(".title span:nth-child(2)").innerText="Новое бинго",document.querySelectorAll("table td").forEach(t=>t.innerText=""),await W();await $()});Ne.addEventListener("click",()=>{document.querySelector(".title span:nth-child(2)").innerText="Новое бинго",document.querySelectorAll("table td").forEach(e=>e.innerText=""),I=null,W()});Fe.addEventListener("click",()=>{const e=document.querySelector(".container");qe.toPng(e).then(n=>{const t=document.createElement("a");t.download="bingo.png",t.href=n,t.click()}).catch(n=>{console.error("Ошибка:",n)})});window.addEventListener("DOMContentLoaded",async()=>{const n=await(await q).getAll("cards");if(n.length>0){const t=n[n.length-1];ee(t.id),I=t.id}else He();await $()});We.addEventListener("click",async()=>{const e={};document.querySelector(".title span:nth-child(2)");const t=await(await q).get("cards",I);e.title=t.title,e.cells=t.cells,e.answers=[[!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1]];const u=JSON.stringify(e),p=Ee.compressToEncodedURIComponent(u),y=`${location.origin}${location.pathname}view.html?data=${p}`;navigator.clipboard.writeText(y),alert("Ссылка скопирована в буфер обмена")});
